# mysql数据库逐个备份脚本

```shell
#!/bin/bash
#Author absolutely.xu@gmail.com
MAXIMUM_BACKUP_FILES=10              #最大备份文件数
BACKUP_FOLDERNAME="/home/mysql_backup"  #数据库备份文件的主目录
DB_HOSTNAME="localhost"              #mysql所在主机的主机名
DB_USERNAME="root"                   #mysql登录用户名
DB_PASSWORD="dosion123456"                 #mysql登录密码
DATABASES=(
                             #备份的数据库名
"nformation_schema"
"activity"
"app-auth"
"assets"
"assets1"
"assets2"
"assets_test"
"assignment"
"assignment-chuzhong"
"assignment_contrast"
"ban-card"
"bank1"
"bank1_pay"
"bank2"
"bedclothes"
"boot-project"
"campus"
"campus-classroom"
"campus-cms"
"campus-job"
"campus-pay"
"campus-questionnaire"
"campus-xueji"
"campus_config"
"campus_upgrade_cms"
"campus_upgrade_file"
"campus_upgrade_goods"
"campus_upgrade_interaction"
"campus_upgrade_iot"
"campus_upgrade_oa"
"campus_upgrade_oa_test"
"campus_upgrade_oauth"
"campus_upgrade_order"
"campus_upgrade_pay"
"campus_upgrade_payment"
"campus_upgrade_polymerization"
"campus_upgrade_questionnaire"
"campus_upgrade_shop"
"campus_upgrade_test"
"campus_upgrade_user"
"campus_upgrade_xxl_job"
"car-business"
"car-business-config"
"cloud-worker"
"cloud-worker-config"
"cloud-worker-jdy"
"cloud-worker-jdy-config"
"cloud-worker-jdy-job"
"cloud-worker-job"
"cloud-worker-shanxi"
"cloud-worker-shanxi-config"
"cloud-worker-shanxi-job"
"cloud-worker-zhongxin"
"cloud-worker-zhongxin-config"
"cloud-worker-zhongxin-job"
"cms"
"code_kube"
"customer-relationship"
"customer-relationship-config"
"customer-relationship-job"
"dcloudx"
"dcloudx-boot"
"dcloudx-boot-job"
"dcloudx-boot-pay"
"dcloudx-job"
"dcloudx_config"
"dianzhaobao-statistics"
"dosion-data"
"dosion-data-v2.0"
"dosion-data-v3"
"dosion-pay"
"dosion-sms"
"dosion_cms"
"dosion_job"
"dosion_utils"
"dosion_utils_codegen"
"dosion_utils_config"
"dosion_utils_job"
"dosion_utils_mp"
"dosion_utils_pay"
"driver-school"
"dudao"
"dudao2"
"dudao3"
"dudao4"
"dudao5"
"education_train_auth"
"education_train_config"
"education_train_oa"
"eschoollink"
"farming-test"
"farming-test-config"
"farming-trade"
"farming-trade-job"
"farming-trade-pay"
"farming_config"
"ff_cms"
"form-design"
"form-design-v3"
"game"
"global-trade"
"global-trade-china"
"gonghui-wenda"
"gonghui-wenjuan"
"gonghui_cms"
"guliedu_ucenter_180808"
"gwm"
"gwmapp-tool-upload"
"hbsyreview"
"hbsyreview2"
"hbsyreview3"
"hmily"
"house-property"
"hty_shop"
"hty_shop_config"
"hxwl_cms"
"hxwl_file"
"hxwl_goods"
"hxwl_interaction"
"hxwl_iot"
"hxwl_oa"
"hxwl_oa_test"
"hxwl_oauth"
"hxwl_order"
"hxwl_pay"
"hxwl_payment"
"hxwl_polymerization"
"hxwl_shop"
"hxwl_shop_1203"
"hxwl_shop_1208"
"hxwl_shop_1212"
"hxwl_shop_pro"
"hxwl_shop_temp"
"hxwl_test"
"hxwl_user"
"hxwl_user_1212"
"hxwl_user_old"
"hxwl_user_pro"
"hxwl_user_temp"
"hxwl_user_test"
"hxwl_xxl_job"
"ibms"
"iercc"
"import-ext"
"interaction"
"internet-phone"
"iot"
"iot-job"
"iot_config"
"iot_config_pig"
"iotpl"
"jing-cat-test"
"jingle-cat"
"jingle-cat-cms"
"jingle-cat-job"
"jingle-cat-pay"
"kettle"
"kifd"
"kube"
"kube-job"
"luxury"
"luxury-appraisal"
"luxury-job"
"luxury-ocr"
"luxury-official"
"luxury-pay"
"luxury-test"
"luxury_config"
"mysql"
"news"
"nhjyj"
"party-building"
"party-building-activity"
"party-building-cms"
"party-building-config"
"party-building-oa"
"party-building-pay"
"party-building-shop"
"pay-center"
"pension"
"pension-activity"
"pension-cms"
"pension-dev"
"pension-iot"
"pension-pay"
"pension-shop"
"performance_schema"
"petrol-station"
"petrol-station-config"
"petrol-station-erp"
"petrol-station-job"
"petrol-station-pay"
"pigxx"
"pigxx_config"
"platform-trade-union"
"platform-trade-union2"
"platform-trade-union3"
"platform-trade-union4"
"platform-trade-union-activity"
"platform-trade-union-contest"
"platform-trade-union-oa"
"platform-trade-union-oa1"
"platform-trade-union-oa2"
"platform-trade-union-plus"
"platform-trade-union-plus-config"
"platform-trade-union-shop"
"platform_trade_union_cms"
"playground"
"poetry"
"prg"
"psychology"
"purchase"
"purchase-back"
"registration"
"restaurant"
"ry-vue"
"scm"
"shenbao"
"shenbao2"
"shida"
"small-video"
"smart-campus"
"smart-campus-job"
"smart_campus_config"
"social_security"
"spark"
"spq_video"
"sql_shop"
"ssrz"
"station-group-ninghe"
"taiwanlu_oa"
"taxi"
"taxi-test"
"taxi_dev"
"tde"
"test"
"test01"
"test-union"
"test_hexidudao"
"test_mianshi"
"testbackup"
"tianmei"
"tianmei-pay"
"tianmei_config"
"tianmei_job"
"tiny-classroom"
"tour-shop"
"tour-shop-job"
"tour-shop-pay"
"tour_shop_config"
"trade_union"
"trade_union_job"
"trade_union_zipkin"
"tripartite-shop"
"ucenter"
"ue-test"
"user_db"
"user_pro_dev_1"
"visual"
"wangbadan"
"wenfeng_cms"
"wxwall"
"xsion"
"xsion-temp"
"xxl-job"
"xxl_job"
"xxpay"
"xxpaydb"
"zabbix"
"zhaosheng"
"zhaosheng-gl"
"zhaosheng-zx"
"zhaosheng_zx"

)
#=========
echo "Bash Database Backup Tool"
#CURRENT_DATE=$(date +%F)
CURRENT_DATE=$(date +%F)              #定义当前日期为变量
BACKUP_FOLDER="${BACKUP_FOLDERNAME}_${CURRENT_DATE}" #存放数据库备份文件的目录
mkdir -p $BACKUP_FOLDER #创建数据库备份文件目录
#统计需要被备份的数据库
count=0
while [ "x${DATABASES[count]}" != "x" ];do
    count=$(( count + 1 ))
done
echo "[+] ${count} databases will be backuped..."
#循环这个数据库名称列表然后逐个备份这些数据库
for DATABASE in ${DATABASES[@]};do
    echo "[+] Mysql-Dumping: ${DATABASE}"
    echo -n "   Began:  ";echo $(date)
    if $(mysqldump -h ${DB_HOSTNAME} -u${DB_USERNAME} -p${DB_PASSWORD} ${DATABASE} > "${BACKUP_FOLDER}/${DATABASE}.sql");then
        echo "  Dumped successfully!"
    else
        echo "  Failed dumping this database!"
    fi
        echo -n "   Finished: ";echo $(date)
done
echo
echo "[+] Packaging and compressing the backup folder..."
tar -cv ${BACKUP_FOLDER} | bzip2 > ${BACKUP_FOLDER}.tar.bz2 && rm -rf $BACKUP_FOLDER
BACKUP_FILES_MADE=$(ls -l ${BACKUP_FOLDERNAME}*.tar.bz2 | wc -l)
BACKUP_FILES_MADE=$(( $BACKUP_FILES_MADE - 0 )) 
#把已经完成的备份文件数的结果转换成整数数字
 
echo
echo "[+] There are ${BACKUP_FILES_MADE} backup files actually."
#判断如果已经完成的备份文件数比最大备份文件数要大，那么用已经备份的文件数减去最大备份文件数,打印要删除旧的备份文件
if [ $BACKUP_FILES_MADE -gt $MAXIMUM_BACKUP_FILES ];then
    REMOVE_FILES=$(( $BACKUP_FILES_MADE - $MAXIMUM_BACKUP_FILES ))
echo "[+] Remove ${REMOVE_FILES} old backup files."
#统计所有备份文件，把最新备份的文件存放在一个临时文件里，然后删除旧的文件，循环出临时文件的备份文件从临时目录里移到当前目录
    ALL_BACKUP_FILES=($(ls -t ${BACKUP_FOLDERNAME}*.tar.bz2))
    SAFE_BACKUP_FILES=("${ALL_BACKUP_FILES[@]:0:${MAXIMUM_BACKUP_FILES}}")
echo "[+] Safeting the newest backup files and removing old files..."
    FOLDER_SAFETY="_safety"
if [ ! -d $FOLDER_SAFETY ]
then mkdir $FOLDER_SAFETY
                                                                                                                    
fi
for FILE in ${SAFE_BACKUP_FILES[@]};do
                                                                                                                      
    mv -i  ${FILE}  ${FOLDER_SAFETY}
done
    rm -rf ${BACKUP_FOLDERNAME}*.tar.bz2
    mv  -i ${FOLDER_SAFETY}/* ./
    rm -rf ${FOLDER_SAFETY}
#以下显示备份的数据文件删除进度，一般脚本都是放在crontab里，所以我这里只是为了显示效果，可以不选择这个效果。
     
CHAR=''
for ((i=0;$i<=100;i+=2))
do  printf "Removing:[%-50s]%d%%\r" $CHAR $i
        sleep 0.1
CHAR=#$CHAR
done
    echo
fi

```

